{% extends "base.html" %} {% block title %}Events - Admin{% endblock %} {% block
content %}

<div class="container mt-4">
  <!-- BACK BUTTON -->
  <div class="mb-3">
    <a
      href="{{ url_for('admin.dashboard') }}"
      class="btn btn-outline-secondary btn-sm"
    >
      â† Back to Dashboard
    </a>
  </div>

  <!-- HEADER -->
  <div
    class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3 gap-2"
  >
    <h2 class="mb-0">ğŸ„ Events</h2>
    <a href="{{ url_for('admin.create_event') }}" class="btn btn-primary">
      â• Create Event
    </a>
  </div>

  {% if events %}

  <!-- RESPONSIVE TABLE WRAPPER -->
  <div class="table-responsive">
    <table class="table table-hover align-middle text-nowrap">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Year</th>
          <th>Participants</th>
          <th>Status</th>
          <th style="min-width: 220px">Actions</th>
        </tr>
      </thead>

      <tbody>
        {% for event in events %}
        <tr>
          <td>{{ event.id }}</td>
          <td class="fw-semibold">{{ event.name }}</td>
          <td>{{ event.year }}</td>

          <!-- PARTICIPANTS -->
          <td>
            <span class="badge bg-primary">
              {{ event.participants|length }}
            </span>
          </td>

          <!-- STATUS -->
          <td>
            {% if event.is_finished %}
            <span class="badge bg-success">Finished</span>
            {% elif event.is_draw_done %}
            <span class="badge bg-warning text-dark">Draw done</span>
            {% else %}
            <span class="badge bg-secondary">Pending</span>
            {% endif %}
          </td>

          <!-- ACTIONS -->
          <td>
            <div class="d-flex flex-wrap gap-1">
              {% if not event.is_draw_done %}
              <a
                href="{{ url_for('admin.edit_event', event_id=event.id) }}"
                class="btn btn-sm btn-outline-warning"
              >
                Edit
              </a>
              {% endif %} {% if not event.is_draw_done %}
              <form
                action="{{ url_for('admin.draw_event', event_id=event.id) }}"
                method="POST"
              >
                <button
                  type="submit"
                  class="btn btn-sm btn-primary"
                  onclick="return confirm('Confirm draw?');"
                >
                  ğŸ² Draw
                </button>
              </form>
              {% endif %} {% if event.is_draw_done and not event.is_finished %}
              <form
                action="{{ url_for('admin.finish_event', event_id=event.id) }}"
                method="POST"
              >
                <button
                  type="submit"
                  class="btn btn-sm btn-outline-warning"
                  onclick="
                    return confirm('Finish event and start poem phase?');
                  "
                >
                  âœ Finish
                </button>
              </form>
              {% endif %} {% if event.is_finished %}
              <a
                href="{{ url_for('admin.view_event_results', event_id=event.id) }}"
                class="btn btn-sm btn-info text-white"
              >
                ğŸ‘ View
              </a>
              {% endif %}

              <form
                action="{{ url_for('admin.delete_event', event_id=event.id) }}"
                method="POST"
              >
                <button
                  type="submit"
                  class="btn btn-sm btn-outline-danger"
                  onclick="return confirm('Delete this event?');"
                >
                  ğŸ—‘
                </button>
              </form>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% else %}
  <div class="alert alert-info">There are no events yet.</div>
  {% endif %}
</div>

{% endblock %}
