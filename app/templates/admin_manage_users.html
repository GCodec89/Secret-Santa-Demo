{% extends "base.html" %} {% block content %}

<h2>Manage Participants</h2>

<!-- Add participant form -->
<form method="POST" class="mb-4">
  <div class="mb-3">
    <label>Name</label>
    <input type="text" name="name" class="form-control" required />
  </div>

  <div class="mb-3">
    <label>Email</label>
    <input type="email" name="email" class="form-control" required />
  </div>

  <div class="mb-3">
    <label>Password</label>

    <div class="input-group">
      <input
        type="text"
        name="password"
        id="password"
        class="form-control"
        required
      />

      <button
        type="button"
        class="btn btn-outline-secondary"
        onclick="generatePassword()"
      >
        Generate
      </button>
    </div>
  </div>

  <button type="submit" class="btn btn-success">Add Participant</button>
</form>

<hr />

<h4>Current Participants</h4>

<ul class="list-group mt-3">
  {% for user in users %}

  <li class="list-group-item d-flex justify-content-between align-items-center">
    {{ user.name }} ({{ user.email }})

    <span>
      <a
        href="{{ url_for('admin.edit_user', user_id=user.id) }}"
        class="btn btn-sm btn-primary"
      >
        Edit
      </a>

      <form
        method="POST"
        action="{{ url_for('admin.delete_user', user_id=user.id) }}"
        style="display: inline-block"
      >
        <button
          type="submit"
          class="btn btn-sm btn-danger"
          onclick="return confirm('Delete this participant?');"
        >
          Delete
        </button>
      </form>
    </span>
  </li>

  {% endfor %}
</ul>

<a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary mt-3">
  Back
</a>

<!-- PASSWORD GENERATOR SCRIPT -->
<script>
  function generatePassword() {
    const numbers = "0123456789";
    const lowercase = "abcdefghijklmnopqrstuvwxyz";
    const uppercase = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const special = "!@#$%&*";

    let password = "";

    // 8 numbers
    for (let i = 0; i < 8; i++) {
      password += numbers.charAt(Math.floor(Math.random() * numbers.length));
    }

    // 1 lowercase
    password += lowercase.charAt(Math.floor(Math.random() * lowercase.length));

    // 1 uppercase
    password += uppercase.charAt(Math.floor(Math.random() * uppercase.length));

    // 1 special char
    password += special.charAt(Math.floor(Math.random() * special.length));

    // Shuffle result
    password = password
      .split("")
      .sort(() => 0.5 - Math.random())
      .join("");

    document.getElementById("password").value = password;
  }
</script>

{% endblock %}
