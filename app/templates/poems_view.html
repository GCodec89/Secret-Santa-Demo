{% extends "base.html" %} {% block content %}
<div class="container mt-4">
  <!-- BACK BUTTON -->
  <div class="mb-3">
    <a
      href="{% if current_user.is_admin_flag %}
               {{ url_for('admin.events') }}
            {% else %}
               {{ url_for('main.dashboard') }}
            {% endif %}"
      class="btn btn-outline-secondary btn-sm"
    >
      â† Back to Dashboard
    </a>
  </div>

  <!-- HEADER -->
  <div class="mb-4">
    <h2 class="mb-0">ğŸ­ {{ event.name }} ({{ event.year }})</h2>
  </div>

  <form
    method="POST"
    action="{% if current_user.is_admin_flag %}
               {{ url_for('admin.view_event', event_id=event.id) }}
            {% else %}
               {{ url_for('secret.view_event', event_id=event.id) }}
            {% endif %}"
  >
    {% for assignment in assignments %}
    <div class="card mb-3 shadow-sm">
      <div class="card-body">
        <h5 class="fw-semibold">
          {{ assignment.giver.name }} â†’ {{ assignment.receiver.name }}
        </h5>

        {% if current_user.is_admin_flag or assignment.giver_id ==
        current_user.id %}
        <textarea
          class="form-control mt-2"
          name="poem_{{ assignment.id }}"
          rows="3"
        >
{{ assignment.poem or "" }}</textarea
        >
        {% else %}
        <p class="mt-2 mb-0">{{ assignment.poem or "No poem yet." }}</p>
        {% endif %}
      </div>
    </div>
    {% endfor %}

    <button type="submit" class="btn btn-primary">ğŸ’¾ Save Poems</button>
  </form>
</div>
{% endblock %}
